name: Deploy Palo Alto Firewall to East US

on:
    push:
        branches:
            - main

jobs:
    deploy:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
            uses: actions/checkout@v2

        - name: Set up Terraform
            uses: hashicorp/setup-terraform@v1
            with:
                terraform_version: 1.0.0

        - name: Initialize Terraform
            run: terraform init

        - name: Validate Terraform
            run: terraform validate

        - name: Plan Terraform
            run: terraform plan -out=tfplan

        - name: Apply Terraform
            if: github.ref == 'refs/heads/main'
            run: terraform apply -auto-approve tfplan